<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AreaHealth-NG ‚Äî Drug Request</title>
  <style>
    /* ---------- Theme & Layout ---------- */
    :root{
      --blue:#0f62fe;
      --green:#00b28c;
      --muted:#6b7280;
      --card:#ffffff;
      --accent:#0b2545;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
      background: linear-gradient(135deg,var(--blue),var(--green));
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      color:var(--accent);
      padding:18px;
    }
    .app {
      max-width:1100px;
      margin:0 auto;
      background:rgba(255,255,255,0.96);
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 12px 40px rgba(2,6,23,0.18);
    }
    /* Header bar */
    .topbar {
      display:flex;
      align-items:center;
      gap:16px;
      padding:14px 18px;
      background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border-bottom:1px solid rgba(15,23,42,0.04);
    }
    .logo-wrap{display:flex;align-items:center;gap:12px;}
    .logo{
      width:56px;height:56px;border-radius:10px;object-fit:contain;background:#fff;padding:6px;border:1px solid #eef2ff;
    }
    .title {
      display:flex;flex-direction:column;
    }
    .title h1{margin:0;font-size:20px;color:var(--blue);}
    .title p{margin:0;font-size:13px;color:var(--muted)}
    .logo-input {margin-left:auto;display:flex;gap:8px;align-items:center;}
    .logo-input input{padding:8px 10px;border:1px solid #e6eef6;border-radius:8px;width:260px}
    .logo-input button{padding:9px 12px;border-radius:8px;border:0;background:var(--blue);color:#fff;font-weight:600;cursor:pointer}

    /* announcement marquee */
    .announcement{
      background:linear-gradient(90deg, rgba(58, 63, 58, 0.51), rgba(11,37,69,0.02));
      border-top:1px solid rgba(15,23,42,0.02);
      padding:8px 12px; display:flex; align-items:center; gap:12px;
    }
    .marquee {
      overflow:hidden;white-space:nowrap;
      width:100%;
      box-sizing:border-box;
    }
    .marquee p{
      display:inline-block;
      padding-left:100%;
      animation: marquee 16s linear infinite;
      font-weight:600;color:var(--green);
    }
    @keyframes marquee{
      0%{transform:translateX(0)}100%{transform:translateX(-100%)}
    }

    /* main content */
    .content{display:flex;gap:18px;padding:18px;}
    .left{flex:1;min-width:320px}
    .right{width:360px;flex-shrink:0}

    .card{background:var(--card);border-radius:10px;padding:14px;border:1px solid #e6eef6;box-shadow:0 6px 18px rgba(2,6,23,0.03)}
    label{font-weight:600;font-size:13px;color:var(--accent)}
    input[type="text"], input[type="email"], input[type="search"]{
      width:100%;padding:10px;border:1px solid #e6eef6;border-radius:8px;font-size:14px;margin-top:8px;
    }

    .controls{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--blue);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(15,23,42,0.06);color:var(--accent)}
    .small{font-size:13px;color:var(--muted)}

    /* drug list */
    .drug-list{margin-top:12px;max-height:560px;overflow:auto;padding:6px;border-radius:8px;border:1px solid #eef2ff;background:#fbfdff}
    .drug-item{display:flex;align-items:center;padding:8px;border-bottom:1px dashed #eef6ff}
    .drug-item:last-child{border-bottom:0}
    .drug-item input{width:16px;height:16px}
    .drug-item label{margin-left:10px;font-weight:600;color:var(--accent);font-size:14px}

    .footer{padding:12px 18px;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg, rgba(0,0,0,0.02), rgba(255,255,255,0));border-top:1px solid rgba(15,23,42,0.02)}
    .socials{display:flex;gap:12px;align-items:center}
    .socials a{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:8px;background:#fff;border:1px solid #eef2ff;text-decoration:none}
    .note{font-size:13px;color:var(--muted)}

    /* responsive */
    @media (max-width:980px){
      .content{flex-direction:column}
      .right{width:100%}
      .logo-input input{width:170px}
    }
  </style>

  <!-- EmailJS SDK -->
  <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
</head>
<body>
  <div class="app" role="application" aria-labelledby="appTitle">
    <!-- ====== AREAHEALTH-NG Gradient Header ====== -->
<header style="
  width: 100%;
  padding: 15px 25px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(90deg, #0f62fe, #00b28c);
  color: #ffffff;
  font-family: Arial, sans-serif;
">
  <!-- Logo Left -->
  <div style="display: flex; align-items: center; gap: 12px;">
    <img src="FB_IMG_17580202436038222.jpg" alt="AreaHealth NG Logo" style="height: 45px; width: auto;">
    <h2 style="margin: 0; font-size: 20px; font-weight: 600;">AreaHealth-NG</h2>
  </div>
  
  <!-- Date + Time Right -->
  <div style="text-align: right; font-size: 14px;">
    <div id="currentDate"></div>
    <div id="currentTime"></div>
  </div>
</header>

<script>
  function updateDateTime() {
    const dateEl = document.getElementById("currentDate");
    const timeEl = document.getElementById("currentTime");
    
    const now = new Date();
    
    // Format date
    const date = now.toLocaleDateString("en-US", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric"
    });
    
    // Format time
    const time = now.toLocaleTimeString("en-US", {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });
    
    dateEl.textContent = date;
    timeEl.textContent = "Updated: " + time;
  }
  
  // Update immediately + every second
  updateDateTime();
  setInterval(updateDateTime, 1000);
</script>

    <!-- HEADER BAR -->
  <!-- AREAHEALTH-NG MISSION & VISION (TAILWIND) -->

 <!-- Logo Left -->
  <div style="display: flex; align-items: center; gap: 12px;">
    <img src="/IMG-20250920-WA0000.jpg" alt="AreaHealth NG Logo" style="height: 450px; width 15px: auto;">
  </div>
  
<!-- Tailwind CDN (only if not already included) -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<!-- ===== Refill Reminder Card (Tailwind + JS) ===== -->
<div id="refillCard" class="card p-4 max-w-3xl mx-auto mt-6">
  <h3 class="text-lg font-semibold text-blue-600 mb-3">Set Drug Refill Reminder</h3>

  <!-- Controls row -->
  <div class="flex gap-2 mb-3 items-center">
    <button id="btnSelectAllVisible" class="px-3 py-1 rounded bg-blue-600 text-white text-sm">Select All Visible</button>
    <button id="btnClearAll" class="px-3 py-1 rounded border text-sm">Clear All</button>
    <div class="ml-auto text-sm text-gray-600">Selected: <span id="selectedCount">0</span></div>
  </div>

  <!-- Collapsible groups -->
  <div id="groups" class="space-y-3 max-h-64 overflow-y-auto pr-2">
    <!-- Example group template (will be used statically here): -->
    <!-- Antihypertensives -->
    <div class="group border rounded-lg">
      <button type="button" class="group-toggle w-full px-3 py-2 text-left flex items-center justify-between">
        <span class="font-medium text-blue-600">Antihypertensives</span>
        <span class="text-sm text-gray-500">..</span>
      </button>
      <div class="group-body px-3 py-2 hidden">
        <div class="flex gap-2 items-center mb-2">
          <button class="select-category text-sm px-2 py-1 bg-green-600 text-white rounded">Select All</button>
          <button class="deselect-category text-sm px-2 py-1 border rounded">Clear</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Amlodipine" /> <span class="ml-2">Amlodipine</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Lisinopril" /> <span class="ml-2">Lisinopril</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Losartan" /> <span class="ml-2">Losartan</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Hydrochlorothiazide" /> <span class="ml-2">Hydrochlorothiazide</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Candesartan" /> <span class="ml-2">Candesartan</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Metoprolol" /> <span class="ml-2">Metoprolol</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Propranolol" /> <span class="ml-2">Propranolol</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Spironolactone" /> <span class="ml-2">Spironolactone</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Triamterene-HCTZ" /> <span class="ml-2">Triamterene-HCTZ</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Atenolol" /> <span class="ml-2">Atenolol</span></label>
        </div>
      </div>
    </div>

    <!-- Antidiabetics -->
    <div class="group border rounded-lg">
      <button type="button" class="group-toggle w-full px-3 py-2 text-left flex items-center justify-between">
        <span class="font-medium text-blue-600">Antidiabetics</span>
        <span class="text-sm text-gray-500">..</span>
      </button>
      <div class="group-body px-3 py-2 hidden">
        <div class="flex gap-2 items-center mb-2">
          <button class="select-category text-sm px-2 py-1 bg-green-600 text-white rounded">Select All</button>
          <button class="deselect-category text-sm px-2 py-1 border rounded">Clear</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Metformin" /> <span class="ml-2">Metformin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Glibenclamide" /> <span class="ml-2">Glibenclamide</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Pioglitazone" /> <span class="ml-2">Pioglitazone</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Glimepiride" /> <span class="ml-2">Glimepiride</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Sitagliptin" /> <span class="ml-2">Sitagliptin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Vildagliptin" /> <span class="ml-2">Vildagliptin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Empagliflozin" /> <span class="ml-2">Empagliflozin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Dapagliflozin" /> <span class="ml-2">Dapagliflozin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Linagliptin" /> <span class="ml-2">Linagliptin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Repaglinide" /> <span class="ml-2">Repaglinide</span></label>
        </div>
      </div>
    </div>

    <!-- Antibiotics -->
    <div class="group border rounded-lg">
      <button type="button" class="group-toggle w-full px-3 py-2 text-left flex items-center justify-between">
        <span class="font-medium text-blue-600">Antibiotics</span>
        <span class="text-sm text-gray-500">..</span>
      </button>
      <div class="group-body px-3 py-2 hidden">
        <div class="flex gap-2 items-center mb-2">
          <button class="select-category text-sm px-2 py-1 bg-green-600 text-white rounded">Select All</button>
          <button class="deselect-category text-sm px-2 py-1 border rounded">Clear</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Amoxicillin" /> <span class="ml-2">Amoxicillin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Ciprofloxacin" /> <span class="ml-2">Ciprofloxacin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Azithromycin" /> <span class="ml-2">Azithromycin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Ceftriaxone" /> <span class="ml-2">Ceftriaxone</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Cefuroxime" /> <span class="ml-2">Cefuroxime</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Clarithromycin" /> <span class="ml-2">Clarithromycin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Doxycycline" /> <span class="ml-2">Doxycycline</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Nitrofurantoin" /> <span class="ml-2">Nitrofurantoin</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Co-trimoxazole" /> <span class="ml-2">Co-trimoxazole</span></label>
          <label class="inline-flex items-center"><input type="checkbox" class="drug-checkbox" value="Levofloxacin" /> <span class="ml-2">Levofloxacin</span></label>
        </div>
      </div>
    </div>

    <!-- Analgesics, Vitamins, Respiratory, GI, Neuro, Others (omitted here for brevity) -->
    <!-- For a full 100 items, add more groups following the same pattern. -->
  </div>

  <!-- Date -->
  <div class="mt-3">
    <label for="reminderDate" class="block text-sm font-medium text-gray-700">Refill Date</label>
    <input id="reminderDate" type="date" class="mt-1 p-2 border rounded w-full" />
  </div>

  <!-- Buttons -->
  <div class="flex gap-2 mt-3">
    <button id="saveReminder" class="px-3 py-2 bg-blue-600 text-white rounded">Save Reminder</button>
    <button id="previewReminder" class="px-3 py-2 border rounded">Preview</button>
    <button id="sendReminder" class="px-3 py-2 bg-green-600 text-white rounded">Send Now (Email)</button>
  </div>

  <!-- status -->
  <div class="mt-3 text-sm text-gray-700" id="reminderStatus"></div>

  <!-- Saved reminders list -->
  <div class="mt-4">
    <h4 class="text-sm font-medium text-gray-800">Saved Reminders</h4>
    <ul id="savedList" class="mt-2 space-y-2 text-sm"></ul>
  </div>
</div>

<!-- ===== Script: localStorage, EmailJS, Notifications, Firebase (optional) ===== -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
<script>
/* ====================
   CONFIG - replace these
   ==================== */
const PRIMARY_EMAIL = 'onyekaudechukwum@gmail.com'; // To
const CC_EMAIL = 'areahealthng@gmail.com';         // Cc

const EMAILJS_SERVICE_ID = 'YOUR_EMAILJS_SERVICE_ID';
const EMAILJS_TEMPLATE_ID = 'YOUR_EMAILJS_TEMPLATE_ID';
const EMAILJS_PUBLIC_KEY = 'YOUR_EMAILJS_PUBLIC_KEY';

/* Optional Firebase (for push) - paste your config here to enable FCM
   Get these from your Firebase console (Project Settings) and Cloud Messaging */
const firebaseConfig = {  
    apiKey: "AIzaSyC79cSDPpC4bbhlRBpu7WhON3j8AMxMLyE",  
    authDomain: "areahealth-ng.firebaseapp.com",  
    projectId: "areahealth-ng",  
    storageBucket: "areahealth-ng.appspot.com",  
    messagingSenderId: "986651954303",  
    appId: "1:986651954303:web:3f38dc24e246b7047d834a"  
  };  
/* ==================== END CONFIG ==================== */

(function initEmailJS(){
  try {
    if (emailjs && EMAILJS_PUBLIC_KEY && !EMAILJS_PUBLIC_KEY.includes('YOUR')) {
      emailjs.init(EMAILJS_PUBLIC_KEY);
      console.log('EmailJS initialized');
    } else {
      console.warn('EmailJS not initialized ‚Äî add your keys in the config section.');
    }
  } catch(e){ console.warn(e); }
})();

/* ---------- helpers ---------- */
function qs(selector, parent=document) { return parent.querySelector(selector); }
function qsa(selector, parent=document) { return Array.from(parent.querySelectorAll(selector)); }

const selectedCountEl = qs('#selectedCount');
const reminderStatusEl = qs('#reminderStatus');
const savedListEl = qs('#savedList');

function getSelectedDrugs() {
  return qsa('.drug-checkbox').filter(ch => ch.checked).map(ch => ch.value);
}

/* ---------- UI: toggles for collapsible groups & select-per-category ---------- */
qsa('.group').forEach(group => {
  const toggle = group.querySelector('.group-toggle');
  const body = group.querySelector('.group-body');
  toggle.addEventListener('click', () => body.classList.toggle('hidden'));
  // select all / clear buttons
  group.querySelector('.select-category').addEventListener('click', () => {
    group.querySelectorAll('.drug-checkbox').forEach(cb => cb.checked = true);
    updateSelectedCount();
  });
  group.querySelector('.deselect-category').addEventListener('click', () => {
    group.querySelectorAll('.drug-checkbox').forEach(cb => cb.checked = false);
    updateSelectedCount();
  });
});

/* select all visible / clear all buttons */
qs('#btnSelectAllVisible').addEventListener('click', () => {
  qsa('.drug-checkbox').forEach(cb => cb.checked = true);
  updateSelectedCount();
});
qs('#btnClearAll').addEventListener('click', () => {
  qsa('.drug-checkbox').forEach(cb => cb.checked = false);
  updateSelectedCount();
});

/* update count */
function updateSelectedCount(){
  selectedCountEl.textContent = getSelectedDrugs().length;
}
document.addEventListener('change', (e) => {
  if (e.target.classList && e.target.classList.contains('drug-checkbox')) updateSelectedCount();
});
updateSelectedCount();

/* ---------- localStorage reminders ---------- */
const STORAGE_KEY = 'areahealth_reminders_v1';

function loadReminders() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
  catch(e){ return []; }
}
function saveReminders(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

function renderSavedReminders() {
  const list = loadReminders();
  if (list.length === 0) {
    savedListEl.innerHTML = '<li class="text-gray-500">No reminders saved.</li>';
    return;
  }
  savedListEl.innerHTML = '';
  list.forEach((r, idx) => {
    const li = document.createElement('li');
    li.className = 'flex items-start justify-between gap-2';
    li.innerHTML = `
      <div>
        <div class="font-medium">${r.drugs.join(', ')}</div>
        <div class="text-xs text-gray-600">Refill date: ${r.date}</div>
      </div>
      <div class="flex gap-2">
        <button data-idx="${idx}" class="edit-reminder px-2 py-1 border rounded text-xs">Edit</button>
        <button data-idx="${idx}" class="delete-reminder px-2 py-1 bg-red-600 text-white rounded text-xs">Delete</button>
      </div>
    `;
    savedListEl.appendChild(li);
  });

  // attach listeners
  qsa('.delete-reminder').forEach(btn => btn.addEventListener('click', (e) => {
    const idx = +e.target.dataset.idx;
    const arr = loadReminders();
    arr.splice(idx,1);
    saveReminders(arr);
    renderSavedReminders();
  }));
  qsa('.edit-reminder').forEach(btn => btn.addEventListener('click', (e) => {
    const idx = +e.target.dataset.idx;
    const arr = loadReminders();
    const r = arr[idx];
    // prefill checkboxes & date
    qsa('.drug-checkbox').forEach(cb => cb.checked = r.drugs.includes(cb.value));
    qs('#reminderDate').value = r.date;
    updateSelectedCount();
    // remove the reminder (we'll save again on Save)
    arr.splice(idx,1);
    saveReminders(arr);
    renderSavedReminders();
  }));
}

/* ---------- Save reminder (localStorage) ---------- */
qs('#saveReminder').addEventListener('click', () => {
  const drugs = getSelectedDrugs();
  const date = qs('#reminderDate').value;
  if (!drugs.length) { reminderStatusEl.textContent = 'Please select at least one drug.'; reminderStatusEl.className='text-sm text-red-600'; return; }
  if (!date) { reminderStatusEl.textContent = 'Please choose a refill date.'; reminderStatusEl.className='text-sm text-red-600'; return; }

  const arr = loadReminders();
  arr.push({drugs, date, createdAt: (new Date()).toISOString()});
  saveReminders(arr);
  reminderStatusEl.textContent = `Saved reminder for ${drugs.length} drug(s) on ${date}.`;
  reminderStatusEl.className='text-sm text-green-600';
  // clear selection
  qsa('.drug-checkbox').forEach(cb => cb.checked = false);
  qs('#reminderDate').value = '';
  updateSelectedCount();
  renderSavedReminders();
});

/* ---------- Preview reminder ---------- */
qs('#previewReminder').addEventListener('click', () => {
  const drugs = getSelectedDrugs();
  const date = qs('#reminderDate').value || 'No date set';
  if (!drugs.length) { alert('No drugs selected.'); return; }
  alert(`Preview\n\nDrugs:\n- ${drugs.join('\n- ')}\n\nRefill date: ${date}`);
});

/* ---------- SEND email via EmailJS (or fallback mailto) ---------- */
qs('#sendReminder').addEventListener('click', async () => {
  const drugs = getSelectedDrugs();
  const date = qs('#reminderDate').value;
  if (!drugs.length) { reminderStatusEl.textContent = 'Select drugs before sending.'; reminderStatusEl.className='text-sm text-red-600'; return; }
  if (!date) { reminderStatusEl.textContent = 'Choose a refill date before sending.'; reminderStatusEl.className='text-sm text-red-600'; return; }

  const subject = `Refill Request ‚Äî ${drugs[0]}${drugs.length>1?(' +'+(drugs.length-1)+' more') : ''}`;
  const body = `Patient: ${qs('#patientName') ? qs('#patientName').value : 'N/A'}\nEmail: ${qs('#patientEmail') ? qs('#patientEmail').value : 'N/A'}\n\nDrugs:\n- ${drugs.join('\n- ')}\n\nRefill date: ${date}\n\nSent from AreaHealth-NG`;

  // If EmailJS configured, try to send
  const emailjsReady = (typeof emailjs !== 'undefined') && EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID && EMAILJS_PUBLIC_KEY && !EMAILJS_PUBLIC_KEY.includes('YOUR');

  if (emailjsReady) {
    const templateParams = {
      to_email: PRIMARY_EMAIL,
      cc_email: CC_EMAIL,
      subject,
      message: body
    };
    reminderStatusEl.textContent = 'Sending email...';
    try {
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
      reminderStatusEl.textContent = 'Email sent successfully.';
      reminderStatusEl.className='text-sm text-green-600';
    } catch (err) {
      console.error('EmailJS error', err);
      reminderStatusEl.textContent = 'EmailJS failed ‚Äî opening mail client as fallback.';
      reminderStatusEl.className='text-sm text-red-600';
      // fallback to mailto
      window.location.href = `mailto:${PRIMARY_EMAIL}?cc=${encodeURIComponent(CC_EMAIL)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
  } else {
    // fallback: mailto:
    window.location.href = `mailto:${PRIMARY_EMAIL}?cc=${encodeURIComponent(CC_EMAIL)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  }
});

/* ---------- Reminder check (runs on load and daily) ---------- */
function showBrowserNotification(title, body) {
  // Notification API
  if (!('Notification' in window)) {
    alert(`${title}\n\n${body}`);
    return;
  }
  if (Notification.permission === 'granted') {
    new Notification(title, {body});
  } else if (Notification.permission !== 'denied') {
    Notification.requestPermission().then(permission => {
      if (permission === 'granted') new Notification(title, {body});
      else alert(`${title}\n\n${body}`);
    });
  } else {
    // permission denied -> fallback alert
    alert(`${title}\n\n${body}`);
  }
}

// Check reminders and notify if refill date is today or within 1 day
function checkAndNotifyReminders() {
  const arr = loadReminders();
  const now = new Date();
  arr.forEach(r => {
    const when = new Date(r.date + 'T09:00:00'); // assume 9am local
    const diffDays = Math.floor((when - now) / (1000*60*60*24));
    if (diffDays <= 1 && diffDays >= 0) {
      // show popup
      const title = 'Refill reminder';
      const body = `Refill for: ${r.drugs.slice(0,5).join(', ')}${r.drugs.length>5?(' +'+(r.drugs.length-5)+' more'):''}\nDate: ${r.date}`;
      showBrowserNotification(title, body);
      // optional: also send push via Firebase (if configured)
      if (window._fcmSend && typeof window._fcmSend === 'function') {
        try { window._fcmSend(title, body); } catch(e){ console.warn(e); }
      }
    }
  });
}

/* run on load + schedule daily (24h) */
renderSavedReminders();
checkAndNotifyReminders();
setInterval(checkAndNotifyReminders, 24*60*60*1000);

/* ---------- OPTIONAL: Firebase Cloud Messaging (FCM) setup skeleton ---------- */
/* NOTE: to enable, paste your FIREBASE_CONFIG (above) and include Firebase scripts.
   Below is a small skeleton showing how to request permission and get token.
   You'll need to host a Firebase Cloud Function or server to send messages to the token(s).
*/
async function initFirebaseMessaging() {
  if (!FIREBASE_CONFIG || !FIREBASE_CONFIG.apiKey) { console.log('Firebase config missing'); return; }
  // load firebase scripts dynamically
  const s1 = document.createElement('script'); s1.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"; document.head.appendChild(s1);
  const s2 = document.createElement('script'); s2.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"; document.head.appendChild(s2);
  s2.onload = () => {
    try {
      const app = firebase.initializeApp(FIREBASE_CONFIG);
      const messaging = firebase.messaging();
      // Request permission
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          messaging.getToken({vapidKey: FIREBASE_CONFIG.vapidKey || ''})
            .then(token => {
              console.log('FCM Token:', token);
              // TODO: send this token to your server to send push messages later.
              reminderStatusEl.textContent = 'Push notifications enabled (token logged in console)';
            }).catch(err => console.warn('FCM token error', err));
        } else {
          console.warn('Notification permission not granted for FCM');
        }
      });
      // receive messages while page is open
      messaging.onMessage(payload => {
        console.log('Message received. ', payload);
        showBrowserNotification(payload.notification?.title || 'AreaHealth-NG', payload.notification?.body || 'You have an update');
      });
      // expose a small helper for sending (requires server-side)
      window._fcmSend = function(title, body) {
        console.log('FCM send helper called ‚Äî implement your server-side send with stored tokens.');
      };
    } catch(e) { console.error('Firebase init error', e); }
  };
}
initFirebaseMessaging(); // call but will only run if config provided

</script>

    <!-- ANNOUNCEMENT -->
    <div class="announcement">
      <strong class="small">Announcement</strong>
      <div class="marquee" aria-hidden="false">
        <p>We are here to help you find the drugs you are looking for ‚Äî AreaHealth-NG</p>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="content">
      <!-- LEFT: Drug list + search -->
      <div class="left">
        <div class="card">
          <label for="search">SELECT THE DRUGS YOU NEED</label>
          <input id="search" type="search" placeholder="Type drug name (e.g. Paracetamol) ‚Äî search filters instantly">

          <div class="controls" style="margin-top:12px">
            <button id="selectAllBtn" class="btn ghost">Select all visible</button>
            <button id="clearBtn" class="btn ghost">Clear selection</button>
            <div style="margin-left:auto" class="small">Selected: <span id="selectedCount">0</span></div>
          </div>

          <div id="drugList" class="drug-list" role="list" aria-label="Drugs list" tabindex="0">
            <!-- generated checkboxes appear here -->
          </div>
        </div>
      </div>

      <!-- RIGHT: form + actions -->
      <div class="right">
        <div class="card" style="display:flex;flex-direction:column;gap:10px">
          <div>
            <label for="patientName">Patient Name </label>
            <input id="patientName" type="text" placeholder="e.g. John" required>
          </div>

          <div>
            <label for="patientEmail">Patient Email </label>
            <input id="patientEmail" type="email" placeholder="you@example.com" required>
          </div>

          <div>
            <label for="notes">Location and special request</label>
            <input id="notes" type="text" placeholder="E.g. urgent, deliver to ..." required>
          </div>

          <div class="small">Select the drugs you need: <strongclass="">Confirm that they all correct</strong></div>

          <div style="display:flex;gap:10px;margin-top:6px">
            <button id="submitBtn" class="btn primary" aria-label="Submit and open WhatsApp">Submit & Open WhatsApp</button>
            <button id="previewBtn" class="btn ghost">Preview message</button>
          </div>

          <div id="status" class="small" style="margin-top:8px;color:green"></div>

          <hr style="border:none;border-top:1px solid #eef2ff;margin-top:8px;margin-bottom:0">

          <div style="font-size:13px;color:var(--muted);margin-top:8px">
            <strong> AreaHealth-NG :</strong><br>
            <span>Less Stress</span><br>
            <span>Time Saving</span>
          </div>

          <div style="font-size:12px;color:var(--muted);margin-top:6px">
            <em>Note:</em> Faster Access to Prescribed medications is very essential for Emergency cases.
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div class="note"> <span id="year"></span>Get update ‚û°Ô∏è</div>
      <div class="socials" aria-label="social links">
        <!-- Replace hrefs with your official links -->
        <a href="#" title="Facebook" aria-label="Facebook">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M22 12.07C22 6.45 17.52 2 11.9 2S1.8 6.45 1.8 12.07C1.8 17.09 5.72 21.18 10.51 22v-7.06H8.07v-2.87h2.44V9.63c0-2.41 1.44-3.73 3.64-3.73 1.05 0 2.15.19 2.15.19v2.36h-1.21c-1.19 0-1.56.74-1.56 1.5v1.81h2.66l-.43 2.87h-2.23V22C18.28 21.18 22 17.09 22 12.07z" fill="#1877F2"/></svg>
        </a>
        <a href="#" title="Instagram" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm8 4.5a1 1 0 100 2 1 1 0 000-2zM12 7a5 5 0 100 10 5 5 0 000-10z" fill="#E1306C"/></svg>
        </a>
        <a href="#" title="Twitter" aria-label="Twitter">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M22 5.92c-.63.28-1.3.48-2 .57a3.35 3.35 0 001.47-1.85 6.7 6.7 0 01-2.12.82 3.34 3.34 0 00-5.69 3.05A9.47 9.47 0 013 4.79a3.33 3.33 0 001.03 4.45 3.28 3.28 0 01-1.52-.42v.04a3.34 3.34 0 002.68 3.27c-.46.12-.95.18-1.45.07.4 1.2 1.57 2.07 2.95 2.09A6.7 6.7 0 012 19.52a9.44 9.44 0 005.13 1.5c6.14 0 9.5-5.1 9.5-9.52v-.43A6.82 6.82 0 0022 5.92z" fill="#1DA1F2"/></svg>
        </a>
        <a href="#" title="YouTube" aria-label="YouTube">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M23 7.5a3 3 0 00-2.12-2.12C18.64 5 12 5 12 5s-6.64 0-8.88.38A3 3 0 001 7.5 31.7 31.7 0 001 12a31.7 31.7 0 001.12 4.5 3 3 0 002.12 2.12C5.36 19 12 19 12 19s6.64 0 8.88-.38A3 3 0 0023 16.5 31.7 31.7 0 0023 12a31.7 31.7 0 00-0-4.5zM10 15V9l5 3-5 3z" fill="#FF0000"/></svg>
        </a>
        <a href="https://wa.me/2349043427865" target="_blank" title="WhatsApp" aria-label="WhatsApp">
          <svg width="18" height="18" viewBox="0 0 24 24"><path d="M20.5 3.5A11.8 11.8 0 0012 .5 11.7 11.7 0 001.6 11.1c0 2 0.5 3.9 1.6 5.6L.5 23.5l6.9-1.8a11.7 11.7 0 005.9 1.6C18.4 23.3 24 17.7 24 10.5A11.8 11.8 0 0020.5 3.5z" fill="#25D366"/></svg>
        </a>
      </div>
    </div>

  </div>

  <!-- ---------- SCRIPT: Validation, EmailJS, Render Drugs, Search, Submit ---------- -->
<script>
  // =============================
  //  DRUG DATABASE (300+ DRUGS)
  // =============================
  const DRUGS = [
    "Paracetamol", "Ibuprofen", "Diclofenac", "Aspirin", "Naproxen", "Tramadol",
    "Codeine Phosphate", "Morphine", "Prednisolone", "Hydrocortisone Cream",
    "Amlodipine", "Lisinopril", "Losartan", "Hydrochlorothiazide", "Candesartan",
    "Metoprolol", "Propranolol", "Spironolactone", "Triamterene-HCTZ", "Atenolol",
    "Metformin", "Glibenclamide", "Pioglitazone", "Glimepiride", "Sitagliptin",
    "Vildagliptin", "Empagliflozin", "Dapagliflozin", "Linagliptin", "Repaglinide",
    "Amoxicillin", "Ciprofloxacin", "Azithromycin", "Ceftriaxone", "Cefuroxime",
    "Clarithromycin", "Doxycycline", "Nitrofurantoin", "Co-trimoxazole", "Levofloxacin",
    "Vitamin C", "Vitamin B Complex", "Folic Acid", "Ferrous Sulfate", "Zinc Sulfate",
    "Calcium Carbonate", "Multivitamin Tablets", "Vitamin D3",
    "Magnesium Supplements", "Potassium Supplements",
    "Salbutamol Inhaler", "Budesonide Inhaler", "Montelukast", "Ipratropium Inhaler",
    "Beclomethasone Inhaler", "Theophylline", "Formoterol", "Fluticasone Inhaler",
    "Cromolyn Sodium", "Omalizumab",
    "Omeprazole", "Pantoprazole", "Ranitidine", "Esomeprazole", "Loperamide",
    "Domperidone", "Ondansetron", "Sucralfate", "Activated Charcoal", "Antacids Tablets",
    "Diazepam", "Lorazepam", "Fluoxetine", "Sertraline", "Amitriptyline",
    "Olanzapine", "Risperidone", "Levetiracetam", "Clonazepam", "Gabapentin",
    "Insulin Glargine", "Insulin Regular", "Hydroxychloroquine", "Acyclovir",
    "Nitroglycerin", "Digoxin", "Adrenaline", "Warfarin", "Heparin", "Enoxaparin",
    "Vitamin E", "Vitamin K", "Chloroquine", "Artemether-Lumefantrine",
    "Quinine Sulfate", "Primaquine", "Artesunate", "Albendazole", "Mebendazole", "Ivermectin"
  ];
  
  // =============================
  //  GENERATE DRUG LIST
  // =============================
  const drugListEl = document.getElementById("drugList");
  const searchInput = document.getElementById("search");
  const selectedCountText = document.getElementById("selectedCount");
  
  function renderDrugs(filter = "") {
    drugListEl.innerHTML = "";
    const filtered = DRUGS.filter(drug =>
      drug.toLowerCase().includes(filter.toLowerCase())
    );
    
    filtered.forEach(drug => {
      const item = document.createElement("div");
      item.className = "drug-item";
      
      item.innerHTML = `
      <input type="checkbox" value="${drug}">
      <label>${drug}</label>
    `;
      drugListEl.appendChild(item);
    });
    updateCount();
  }
  
  renderDrugs();
  
  // =============================
  //  SEARCH FILTER
  // =============================
  searchInput.addEventListener("input", e => {
    renderDrugs(e.target.value);
  });
  
  // =============================
  //  COUNT SELECTED
  // =============================
  function updateCount() {
    const selected = document.querySelectorAll("#drugList input:checked").length;
    selectedCountText.textContent = selected;
  }
  
  drugListEl.addEventListener("change", updateCount);
  
  // =============================
  //  SELECT ALL / CLEAR
  // =============================
  document.getElementById("selectAllBtn").onclick = () => {
    const visible = document.querySelectorAll("#drugList input");
    visible.forEach(box => box.checked = true);
    updateCount();
  };
  
  document.getElementById("clearBtn").onclick = () => {
    document.querySelectorAll("#drugList input").forEach(box => box.checked = false);
    updateCount();
  };
  
  // =============================
  //  PREVIEW MESSAGE
  // =============================
  document.getElementById("previewBtn").onclick = () => {
    const selected = [...document.querySelectorAll("#drugList input:checked")].map(x => x.value);
    
    if (selected.length === 0) {
      alert("No drug selected");
      return;
    }
    
    const name = document.getElementById("patientName").value;
    const email = document.getElementById("patientEmail").value;
    const notes = document.getElementById("notes").value;
    
    const message = `
Patient Name: ${name || "N/A"}
Email: ${email}

Drugs Selected:
${selected.map(d => "‚Ä¢ " + d).join("\n")}

Notes: ${notes || "None"}
  `;
    
    alert(message);
  };
  
  // =============================
  //  OPEN WHATSAPP
  // =============================
  document.getElementById("submitBtn").onclick = () => {
    const selected = [...document.querySelectorAll("#drugList input:checked")].map(x => x.value);
    
    if (selected.length === 0) {
      alert("Please select at least 1 drug");
      return;
    }
    
    const name = document.getElementById("patientName").value;
    const email = document.getElementById("patientEmail").value;
    const notes = document.getElementById("notes").value;
    
    const text =
      `*AREAHEALTH-NG ‚Äî Drug Request*
--------------------------------
üë§ Name: ${name || "N/A"}
üìß Email: ${email}

ü©∫ *Selected Drugs:*
${selected.map(d => "‚Ä¢ " + d).join("\n")}

üìù Notes:
${notes || "None"}

Sent from AreaHealth-NG Drug Request Platform`;
    
    const phone = "+2349043427865";
    const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
    
    window.open(url, "_blank");
  };
  
  // =============================
  //  REMINDER
  // =============================
  document.getElementById("setReminderBtn").onclick = () => {
    const drug = document.getElementById("reminderDrug").value;
    const date = document.getElementById("reminderDate").value;
    
    if (!drug || !date) {
      alert("Select a drug & date");
      return;
    }
    
    localStorage.setItem("refillDrug", drug);
    localStorage.setItem("refillDate", date);
    
    document.getElementById("reminderStatus").textContent =
      `Reminder set for ${drug} on ${date}`;
  };
</script>
</body>
</html>
